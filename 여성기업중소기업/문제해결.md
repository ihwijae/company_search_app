# SMPP 상세정보(기업특징) 페이지 접속 문제 정리

## 1. 증상

- 사업자번호로 목록까지는 잘 조회되는데,
- **상세정보(기업특징) 페이지로 들어가는 요청을 보낼 수 없어서**  
  여성기업/소기업 유효기간을 가져오지 못하는 문제가 있었음.
- 스크립트 상에서는 대략 이런 에러 메시지가 발생:
  - “상세 페이지 링크를 찾지 못했습니다.”

---

## 2. 잘못된 전제(초기 접근)

처음에는 목록 페이지에 이런 형태의 링크가 있을 거라고 가정함:

```html
<a href="/cop/registcorp/selectRegistCorpSumryInfoVw.do?registCorpSn=12345">상세</a>
그래서 코드에서는 대략 이렇게 찾으려고 했음:

python
코드 복사
link = soup.find("a", href=lambda h: h and "selectRegistCorpSumryInfoVw.do" in h)
하지만 실제 HTML 구조는 이런 href가 전혀 없음.

3. 실제 목록 페이지 구조
검색 결과에서 업체명을 클릭하는 부분은 다음과 같이 되어 있음:

html
코드 복사
<a href="#" class="subject" onClick="javascript:fn_moveDetail('2168115499')">
  (주)대상전력
</a>
페이지 하단에는 자바스크립트 함수와 숨은 폼이 있음:

javascript
코드 복사
// 상세화면으로 이동
function fn_moveDetail(bsnmNo){
    var obj = document.moveForm;
    obj.bsnmNo.value = bsnmNo;
    obj.action = "/cop/registcorp/selectRegistCorpSumryInfoVw.do";
    obj.submit();
}
html
코드 복사
<form name="moveForm" method="post">
    <input type="hidden" name="cntrctEsntlNo" value=""/>
    <input type="hidden" name="menuId" value="5040101"/>
    <input type="hidden" name="pageIndex" value="1"/>
    <input type="hidden" name="searchBsnmNo" value="2168115499" title="검색 사업자번호"/>
    <input type="hidden" name="bsnmNo" value="" title="사업자번호"/>
    ...
</form>
정리
상세페이지로 가는 직접 URL 링크(href) 는 없음.

브라우저에서는:

링크 클릭 → fn_moveDetail('2168115499') 호출

moveForm.bsnmNo = '2168115499'

moveForm.action = "/cop/registcorp/selectRegistCorpSumryInfoVw.do"

moveForm.submit() 으로 POST 요청 전송

즉, “JS + 숨은 form 제출” 방식이라 단순히 href만 찾으면 절대 안 나오는 구조.

4. 해결 방법 – JS 동작을 그대로 흉내 내기
4.1 핵심 아이디어
“자바스크립트가 하는 일을 requests/axios로 직접 재현한다”

구체적으로는:

목록 HTML에서 moveForm 폼을 찾는다.

그 안의 <input type="hidden">들을 모두 읽어서 payload 객체를 만든다.

payload["bsnmNo"] 값을 사업자번호(숫자만) 으로 채운다.

필요시 payload["searchBsnmNo"]도 채워준다.

이 payload를 그대로 selectRegistCorpSumryInfoVw.do 에 POST 요청한다.

4.2 파이썬 예시 (핵심 부분만)
python
코드 복사
from bs4 import BeautifulSoup
import re
import requests

LIST_URL    = "https://www.smpp.go.kr/cop/registcorp/selectRegistCorpListVw.do"
SUMMARY_URL = "https://www.smpp.go.kr/cop/registcorp/selectRegistCorpSumryInfoVw.do"

def build_move_form_payload_from_list_html(html: str, biz_no: str) -> dict:
    soup = BeautifulSoup(html, "html.parser")
    form = soup.find("form", attrs={"name": "moveForm"})
    if not form:
        raise RuntimeError("moveForm 폼을 찾지 못했습니다.")

    payload = {}
    for inp in form.find_all("input"):
        name = inp.get("name")
        if not name:
            continue
        value = inp.get("value", "")
        payload[name] = value

    # 사업자번호에서 숫자만 추출해서 bsnmNo 에 세팅
    digits = re.sub(r"\D", "", biz_no)
    payload["bsnmNo"] = digits

    # searchBsnmNo 가 비어 있으면 채워줌
    if "searchBsnmNo" in payload and not payload["searchBsnmNo"]:
        payload["searchBsnmNo"] = digits

    return payload

def fetch_summary_html(session: requests.Session, payload: dict) -> str:
    resp = session.post(SUMMARY_URL, data=payload)
    resp.raise_for_status()
    return resp.text
Node/Electron에서는 cheerio로 moveForm을 파싱하고,
new URLSearchParams(payload) 형태로 SUMMARY_URL에 POST하면 동일하게 동작함.

5. 한 줄 요약
문제 원인: 상세페이지 링크가 href로 직접 존재하는 게 아니라
fn_moveDetail() + moveForm.submit() 구조라서, 단순히 href를 찾는 방식이 실패함.

해결 방법: 목록 HTML에서 form[name="moveForm"]의 hidden 필드들을 파싱해 payload를 만들고,
payload["bsnmNo"]에 사업자번호를 넣은 뒤 /cop/registcorp/selectRegistCorpSumryInfoVw.do에 직접 POST로 요청함./