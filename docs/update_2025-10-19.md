# 품질평가 필터 개선 및 지역사 찾기 창 상태 유지 작업 (2025-10-19)

## 1. LH 품질 필터 보완
- 수정 파일: `searchLogic.js`
- 변경 사항: `hasQualityEvaluation()`에서 `normalized.includes('없음')` 조건을 추가하여 `없음(25.05.01)`형 문자열도 필터에서 제외되도록 처리.

## 2. 지역사 찾기 창 전역화 및 상태 유지
- 수정 파일: `src/view/features/agreements/context/AgreementBoardContext.jsx`
  - 지역사 찾기 창 상태(`candidatesWindow`)를 컨텍스트가 관리하도록 확장.
  - `openCandidatesModal` 호출 시 공고 정보, 팀 구성, 후보/고정/제외 목록을 모두 상태에 저장.
  - `applyCandidatesSelection`으로 적용 결과가 컨텍스트에 즉시 반영되어 페이지 이동 시에도 유지.
  - `CandidatesModal`을 컨텍스트 레벨에서 렌더링하도록 변경.
- 수정 파일: `src/view/features/agreements/pages/AgreementFlowPage.jsx`
  - 페이지 로컬 상태와 컨텍스트 상태를 동기화하도록 훅 정리.
  - `openCandidatesModal` 호출 시 기존 후보/고정/제외 목록을 `initialCandidates` 등으로 전달하고, 참가자격금액 입력이 비어 있으면 공백으로 유지.

## 3. 지역사 찾기 창에서 기존 선택 목록 복원 및 표시 강화
- 수정 파일: `src/view/features/agreements/components/CandidatesModal.jsx`
  - 새 props(`initialCandidates`, `initialPinned`, `initialExcluded`)를 받아 창이 열릴 때 기존 선택을 그대로 보여줌.
  - 초기 목록이 있으면 자동 검색을 건너뛰고 UI가 비지 않도록 처리.
  - 정렬 버튼을 지분/5년실적/시평액 기준으로 확장하고 각각의 고/저순 정렬을 지원.
  - 후보 검색용 텍스트 필터를 추가해 업체명·대표자를 바로 검색 가능.
  - 여성기업은 `女` 배지, 품질평가가 있는 업체는 `품질평가 [점수]` 배지를 노출.
- 수정 파일: `agreements-settings.json`
  - 기본 alwaysInclude 리스트에서 우진일렉트, 아람이엔테크, 지음이엔아이를 제거해 기본 뱃지가 나타나지 않도록 정리.
- 수정 파일: `src/view/features/agreements/components/AgreementBoardWindow.jsx`
  - 사이드바 섹션명을 “대표사 후보”에서 “대기 업체”로 변경하고 빈 리스트 안내 문구를 조정.
  - 대표사/지역사 카드와 사이드바 목록에 여성기업·품질평가 배지를 추가해 지표를 바로 확인.
  - 지분 합계가 100%가 아니어도 지분(%/100) 기준으로 경영·실적 점수를 산출하도록 변경하고, 합계 배지를 색상으로 강조.
- 수정 파일: `src/components/CompanySearchModal.jsx`
  - 업체 조회 모달에 업종 배지, 여성기업/품질평가 배지, 담당자 이름 뱃지를 표시해 검색 결과 정보를 강화.

## 4. 검색 결과 툴바 UI 및 필터 초기화 개선
- 수정 파일: `src/styles.css`
  - 결과 툴바 버튼 글꼴 크기/패딩을 조정하고 줄바꿈을 방지해 한 줄에 표시되도록 개선.
- 수정 파일: `src/index.css`
  - 결과 툴바·페이지네이션 사이 여백을 조정하고 페이지 버튼을 주황색 계열로 강조해 다음 페이지를 쉽게 인지하도록 개선.
- 수정 파일: `src/view/features/search/pages/SearchPage.jsx`
  - 새 검색 실행 시 `최신만`, `LH품질`, `여성기업` 필터를 기본값(비활성)으로 자동 초기화.
  - 내부 검색 함수(`executeSearch`)가 필터 Override 값을 받아 즉시 반영하도록 확장.
  - `PAGE_SIZE`를 12로 조정해 페이지당 결과 수를 줄이고 스크롤 발생을 완화.

## 테스트/확인 제안
1. Agreement 화면에서 지역사 찾기 → 후보 선택 및 적용.
2. 다른 화면으로 이동했다가 다시 Agreement 화면으로 돌아온 후 지역사 찾기 창을 열어 기존 선택이 유지되는지 확인.
3. 협정보드를 열어 후보/고정/제외 상태가 일치하는지 확인.

> 자동 테스트는 수행하지 않았으므로 위 수동 확인 절차를 권장합니다.


## 업체 검색 UI 배지 및 필터 영역 다듬기 (2025-10-20)
- 수정 파일: `src/view/features/search/pages/SearchPage.jsx`
  - 검색 결과 항목에 여성기업(`女`), LH 품질평가(`LH`) 뱃지를 추가해 리스트에서 한눈에 식별 가능하도록 개선.
  - 여성기업/품질 여부 판정 헬퍼를 도입해 필터·뱃지가 동일 기준으로 동작하게 통합.
- 수정 파일: `src/index.css`
  - 결과 행의 이름/뱃지 영역 레이아웃을 정리하고 여백을 조정해 담당자/뱃지가 겹치지 않도록 수정.
- 수정 파일: `src/styles.css`
  - 검색 패널 좌측 폭을 소폭 조정하고, 파일 유형 토글을 캡슐형 버튼으로 재구성해 선택 강조를 명확히 함.
  - 버튼 글꼴 크기를 13px로 맞춰 남는 공간을 활용하면서 가독성을 확보.
- 확인 권장: 검색 페이지에서 여성기업·LH 품질 토글 활성화 후 리스트에 새 뱃지가 정상 표시되는지, 파일 유형 버튼이 한 줄에 잘리지 않고 강조 표시가 맞는지 확인.

## 실적 DB 초기화 기반 작업 (2025-10-20)
- 신규 파일: `src/main/features/records/recordsDatabase.js`
  - sql.js (Wasm) 기반 레코드 저장소 초기화 로직과 마이그레이션(버전 1) 구현.
  - `companies`, `categories`, `projects`, `project_categories`, `attachments`, `meta` 테이블 생성 및 핵심 인덱스 정의.
  - 사용자 데이터 디렉터리에 `records.sqlite`를 저장하고 변경 시 export하여 유지.
- 신규 파일: `src/main/features/records/defaults.json`
  - 기본 카테고리/업체 목록을 정의해 초기 구동 시 자동 시드. (업체 기본값: 지음이엔아이㈜, ㈜대흥디씨티, 아람이엔테크㈜, ㈜우진일렉트, 에코엠이엔씨㈜, ㈜지음쏠라테크)
- 수정 파일: `main.js`
  - 앱 시작 시 실적 DB를 선행 초기화하도록 `ensureRecordsDatabase`를 await하고, RecordsService/IPC를 연결.
- 수정 파일: `package.json`
  - `better-sqlite3` 제거, `sql.js` 의존성 추가.
- 신규 파일: `src/main/features/records/recordsRepository.js`
  - sql.js를 사용하는 CRUD 레이어 구현(프로젝트/카테고리/업체/첨부, 필터 포함 조회 지원).
- 신규 파일: `src/main/features/records/recordsService.js`
  - 파일 시스템 첨부 관리 포함 도메인 서비스 계층 구현, 변경 시 DB export 실행.
- 신규 파일: `src/main/features/records/ipc.js`
  - 실적 CRUD/마스터 관리용 IPC 채널 등록(`records:*`).
- 수정 파일: `main.js`
  - RecordsService 인스턴스 생성 및 IPC 핸들러 등록.
- 신규 파일: `src/shared/recordsClient.js`
  - renderer에서 사용할 records IPC 래퍼 추가.
- 신규 파일: `src/view/features/records/pages/RecordsPage.jsx`, `src/view/features/records/components/ProjectModal.jsx`
  - 실적 메인 화면/등록·수정 모달 1차 구현(카테고리 트리·필터·리스트, 기본 등록 흐름). 좌측 카테고리 + 우측(리스트·상세) 2분할로 구성하고 상세 패널에서 실적 수정/첨부 삭제/실적증명서(PDF) 열기 지원.
  - 모달에서 첨부 파일(PDF/이미지) 업로드를 지원하고, 저장 시 sql.js DB 및 파일을 함께 반영.
- 수정 파일: `preload.js`
  - `electronAPI.records.*` IPC 브리지 노출.
- 수정 파일: `src/components/Sidebar.jsx`, `src/App.jsx`, `src/index.css` 등
  - 메뉴에 “실적” 추가 및 신규 레이아웃/스타일 반영, 기존 페이지에서도 실적 메뉴 라우팅 지원.

## 차후에 이제 조달청 50억미만 협정기능 구현 예정.
