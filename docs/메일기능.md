# 메일 발송 기능 현황 (2025-02-14)

## 완료된 주요 항목

1. **SMTP 통합 및 테스트 메일**
   - `nodemailer` 기반 SMTP 서비스(`src/main/features/mail/smtpService.js`) 구현.
   - `mail:send-test`, `mail:send-batch` IPC 추가로 테스트/일괄 발송 모두 지원.
   - 템플릿 치환값(제목/본문 HTML)을 그대로 적용하여 테스트 메일에서도 실제 스타일 확인 가능.

2. **일괄 발송 로직**
   - `MailAutomationPage.jsx`에서 수신자별 템플릿 치환 → SMTP 메시지 생성 → IPC로 전송.
   - 첨부파일을 복수개 누적하고, 발송 상태를 `대기/발송 중/완료/실패`로 표시.
   - 발송 중간에 오류가 발생해도 나머지 업체는 계속 진행되며, 실패 건은 실패 사유(예: 인증 오류)를 상태 메시지에 표시.

3. **주소록 개선**
   - `src/view/features/mail/addressBook.seed.json`을 기본값으로 사용하되, `loadPersisted('mail:addressBook')`으로 사용자 변경분을 저장/불러오기.
   - 주소록 모달에 검색, 가져오기(덮어쓰기), 내보내기, 저장(alert) 버튼 추가.
   - 업체명을 콤마로 구분해 여러 업체를 한 담당자에게 매핑 가능. 자동 매칭 시 동일 담당자가 여러 업체를 맡는 구조 지원.
   - 업체명 자동 매칭: 엑셀 불러오기/업체명 수정 시 주소록 인덱스를 조회해 담당자/이메일 자동 채움. 중복 담당자 발견 시 `담당자` 필드에 `[중복 확인] ...` 메시지를 넣어 사용자 확인 유도.

4. **템플릿 미리보기 & 공통 수신자 토글**
   - “치환 미리보기” 버튼으로 HTML 미리보기 모달 표시.
   - “받는사람에 팀장님 추가” 토글을 통해 조세희 상무님(`superssay@naver.com`)을 모든 메일의 `To` 헤더에 자동 포함.

5. **기타 편의 사항**
   - `받는사람에 팀장님 추가` 버튼의 상태를 즉시 표시(ON/OFF).
   - `비우기` 버튼으로 작성 중이던 프로젝트 정보/업체/첨부/템플릿을 한 번에 초기화할 수 있음.
   - SMTP 설정은 프로필로 저장/불러오기/삭제가 가능해 반복 입력 없이 재사용할 수 있음.
   - 주소록 모달/템플릿 미리보기 모달은 배경 클릭으로 닫히지 않고, 닫기 버튼으로만 닫힘.

## 다음에 고려할 만한 작업

1. **실패 건 재발송**: `상태`가 `실패`인 업체만 필터링해 다시 발송하는 기능.
2. **발송 로그 저장**: 메일 제목/수신자/결과/시간을 파일(JSON/CSV)로 남겨 추후 감사/확인을 쉽게 함.
3. **템플릿 HTML 에디터/치환 미리보기 고도화**: 현재 미리보기는 HTML만 보여주므로, 향후 CSS/브라우저 렌더링 차이에 대비해 iframe 기반 미리보기 등을 고려.
4. **주소록 입력 검증**: 이메일 형식 검증, 업체명 중복 경고 등 기본적인 검증 로직.
5. **실패 이유 알림**: 현재 상태 메시지에 첫 번째 실패 사유만 표시하므로, 리스트에서 개별 업체의 실패 사유를 hover/tooltip으로 보여주면 더 명확할 것.
