📁 실적관리 프로그램 – 첨부파일 관리 전략

본 문서는 클라우드 서버 없이 로컬 환경에서 팀원 간 파일 공유가 가능한 실적관리 프로그램을 위한 첨부파일 관리 방식을 정리한 것이다.
DB로는 sql.js(WASM SQLite) 를 사용하며, 첨부파일은 폴더 기반으로 관리한다.

✅ 전체 개념 요약

모든 데이터는 한 폴더 안에 저장한다.

이 폴더에는
① SQLite DB 파일(records.sqlite)
② 첨부파일이 담긴 attachments 폴더
두 가지가 포함된다.

팀원은 이 폴더를 통째로 .zip으로 주고받아 사용하면 된다.

프로그램은 폴더를 열기만 하면 DB + 첨부파일을 모두 찾을 수 있다.

클라우드 환경이 없어도 협업 가능.

✅ 폴더 구조
실적데이터/
 ├─ records.sqlite            # sql.js로 만든 SQLite DB 파일
 ├─ attachments/              # 첨부파일 실물 저장소
 │   ├─ ab/cd/<hash>.<ext>    # 파일 내용 해시를 이용한 구조
 │   └─ ...
 └─ meta.json                 # 선택(앱 버전/스키마 정보)

📌 구조 특징

records.sqlite와 첨부파일이 같은 폴더에 있으므로 이동해도 경로 깨지지 않음

attachments/ 안의 파일은 내용 기반 SHA-256 해시로 이름 지정
→ 동일한 파일 중복 저장 방지(파일 Deduplication)

폴더 전체를 그대로 복사/공유하면 됨

✅ DB 설계 방향 (요약)

DB에는 파일 자체를 저장하지 않는다(BLOB 금지).
대신 파일에 대한 메타데이터만 저장한다.

attachments 테이블 예시
컬럼명	의미
id	첨부 고유 ID
record_id	어떤 실적에 속하는 첨부인지
original_name	사용자가 업로드한 원본 파일명
mime	MIME 타입
bytes	파일 크기
sha256	파일 내용 해시
rel_path	DB 기준 상대경로 → 예: attachments/ab/cd/<hash>.pdf
created_at	첨부 등록 시간
왜 상대경로만 저장하나?

폴더를 그대로 이동/복사해도 첨부파일 경로가 깨지지 않기 때문

절대경로(C:/Users/…)를 저장하면 공유 시 100% 깨진다

✅ 첨부파일 저장 방식 (업로드 흐름)

사용자가 파일을 선택

파일 내용으로 SHA-256 해시 계산

저장 경로 결정

attachments/ab/cd/<hash>.<확장자>


동일한 해시가 이미 있으면 → 복사하지 않고 재사용

DB에 메타데이터 insert

필요한 경우 썸네일 생성(선택)

✅ 첨부파일 읽기 (다운로드/미리보기)

프로그램은 DB의 rel_path를 읽고
폴더내 실제 파일을 찾는다

이미지, PDF 등은
렌더러에서 미리보기 표시 또는 OS 기본 프로그램으로 열기

✅ 파일 공유 방식
보내는 사람

실적데이터/ 폴더 전체를 zip으로 묶어 팀원에게 전달

받는 사람

폴더 압축 해제

프로그램에서 데이터 폴더 선택

DB + 첨부파일을 그대로 사용 가능

✨ 첨부파일 손상/누락 위험 없음

✅ 충돌 방지(편집자 1명 원칙)

폴더 기반 공유의 특성상 동시편집 금지를 권장한다.

편집할 때
실적데이터/locks/edit.lock 파일 생성

다른 사용자가 열면
→ 읽기 전용 모드 또는 경고 표시

저장/종료 시 lock 삭제

✅ 백업 전략

저장할 때마다 자동으로 DB 스냅샷 생성 (선택)

backups/records_YYYYMMDD-HHMM.sqlite


전체 폴더를 그대로 zip 백업해도 문제가 없다.