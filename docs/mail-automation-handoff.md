# 메일 자동화 기능 – 진행 현황 및 인계 노트

## 현재 구현 상태

- `#/mail` 화면 추가: 엑셀 업로드 → 공고 정보/투찰금액 자동 채움 → SMTP 프로필 입력 → 업체별 첨부 및 상태 관리 흐름 구축.
- 엑셀 파싱: C1~C5(공고번호, 공고명, 발주처, 입찰마감일시, 기초금액) + C8/D8부터 업체명/투찰금액 매칭.
- 템플릿 기본값: `{{announcementNumber}}`, `{{announcementName}}`, `{{owner}}`, `{{closingDate}}`, `{{baseAmount}}`, `{{tenderAmount}}`, `{{vendorName}}` 등 변수 치환 구조 마련.
- 주소록: 별도 모달에서 업체/담당자/이메일 등록, JSON 내보내기/가져오기, 수신자 목록에 즉시 투입 가능.
- SMTP UI: Gmail/Naver 전용 필드 + 커스텀 SMTP(호스트/포트/계정/암호). 발신자/회신 주소 입력 추가.
- 상태 메시지: 주요 동작(엑셀 로드, 주소록 변경, 테스트/발송 버튼)마다 안내.

## 남은 작업 / TODO

1. **메일 템플릿 완성**
   - 실제 발송용 HTML/텍스트 본문 작성 및 프리뷰 기능 구현.
   - 템플릿 미리보기, 변수 치환 로직(Handlebars 등) 연동.

2. **SMTP 연동 보완**
   - Nodemailer 기반 실제 발송/테스트 메일 기능 연결.
   - 주소록과 수신자 목록의 검증(중복, 필수값) 정교화.
   - 발송 로그 저장(예: SQLite `mail_logs` 테이블) 및 UI 노출 여부 결정.

3. **엑셀 파싱 고도화** (선택)
   - 업체 목록을 엑셀에서 직접 불러오는 기능(현재는 UI에서 수동 추가).
   - 여러 포맷(다른 행/열) 지원 필요 시 매핑 프리셋 설계.

4. **첨부/발송 UX**
   - 첨부 다중 선택, 일괄 첨부, 첨부 미리보기 등 편의 기능 검토.
   - 발신자 계정별 한도 고려(지연 시간, 실패 재시도 등) 실제 로직에 반영.

## 참고 링크 / 추가 자료

- 메일 완성본 예시는 `메일발송/메일완성본예시.md` 및 동일 경로의 이미지 참고.
- 엑셀 포맷: C열 1~5, 8행 이후 업체·투찰금 데이터 (지정된 구조 유지 필요).

## 테스트 시 주의 사항

- `.xls` 파일도 허용하지만 구버전 문자셋 문제 발생 시 `xlsx` 의존성 업데이트 필요.
- SMTP 테스트 전에 Gmail 앱 비밀번호/네이버 SMTP 사용 설정 필수.
- 주소록 JSON 구조: `[ { "vendorName": "...", "contactName": "...", "email": "..." }, ... ]`

필요 시 다음 세션에서 템플릿/SMTP 연동부터 이어서 진행하면 됩니다.
