# 자동협정 프로그램 화면 구성 및 데이터 흐름 정리

## 1. 개요
자동협정 프로그램은 협력업체 엑셀 데이터로부터 업체 정보를 불러와 협정 단위로 자동 분류, 점수 계산, 검증, 출력하는 시스템이다.  
UI는 엑셀 시트 구조를 기반으로 한 **세로 테이블형 화면**으로, 각 행이 하나의 협정을 의미한다.

---

## 2. 주요 화면 구성

### 2.1 상단 헤더바
| 버튼명 | 기능 설명 |
|--------|------------|
| 업체 불러오기 | 관리 엑셀에서 협력업체 정보를 불러옴 |
| 룰 프로파일 | 발주처별 계산 규칙 및 가중치 로드/저장 |
| 협정설정 | 협정 수, 최소/최대 인원, 주관사 조건 등 설정 |
| 자동협정 제안 | 자동 알고리즘으로 조합 제안 (균형형/최대점수형 등) |
| 검증 | 제약 위반 및 엑셀 계산 일치 여부 검사 |
| Export | 결과를 제출용 엑셀 또는 PDF로 내보내기 |
| Undo / Redo | 협정 배치 및 지분 변경의 되돌리기 / 다시하기 |

---

### 2.2 본문 테이블 (협정 시트)
각 행은 **하나의 협정(Group)** 을 나타냄.  
표는 엑셀 시트처럼 구성되어 있으며 자동 계산 및 편집이 가능함.

| 열 이름 | 설명 |
|----------|------|
| 협정번호 | 협정 식별 번호 |
| 총점 | 자동 계산된 협정 총합 점수 |
| 적격여부 | 평가 기준 충족 여부 (배지로 표시) |
| 참여가능비율 | 주관사 기준 참여 가능 비율 |
| 대표사 | 협정 내 대표 업체 |
| 구성사1~4 | 협정에 참여하는 업체 목록 |
| 각 지분율 | 업체별 참여 지분 (합계 100%) |
| 경영점수 | 업체별 경영평가 점수 |
| 실적점수 | 시공 실적 및 가점 계산 결과 |
| 시공평점 | 시공능력 점수 |
| 예상점수 | 최종 산정된 종합 점수 |
| 경고 | 제약 위반 시 표시 (색상/아이콘 표시) |

---

### 2.3 좌측 패널 (업체 풀)
협정에 포함되지 않은 업체를 표시하는 후보 리스트.  
검색/정렬/필터 기능을 제공하며, 드래그&드롭으로 협정 행에 추가 가능.

**항목**
- 회사명
- 경영점수
- 실적금액
- 신인도/감점 아이콘
- “배치됨” 배지 (이미 협정에 포함된 경우)

---

## 3. 데이터 흐름

### 3.1 데이터 구조 개요

```plaintext
┌───────────────────────────────┐
│ 엑셀 원본(협력업체 관리표)      │
│  → 업체명, 경영점수, 실적액 등   │
└────────────┬──────────────────┘
             │
             ▼
┌───────────────────────────────┐
│ Company Pool (후보업체 리스트)  │
│  필터·검색·드래그 대상          │
└────────────┬──────────────────┘
             │
             ▼
┌───────────────────────────────┐
│ Groups (협정 목록)            │
│  - 협정ID, 업체ID목록, 지분율  │
│  - 계산결과(총점,적격여부 등) │
└────────────┬──────────────────┘
             │
             ▼
┌───────────────────────────────┐
│ Calculation Engine (계산엔진)  │
│  - 경영/실적/가점 계산         │
│  - 반올림·가중치 적용          │
│  - 제약검사 및 적격판정        │
└────────────┬──────────────────┘
             │
             ▼
┌───────────────────────────────┐
│ 검증 / Export 단계             │
│  - 제약 위반 리포트            │
│  - 엑셀 대조 검증              │
│  - 제출용 엑셀/PDF 출력        │
└───────────────────────────────┘
```

---

## 4. 인터랙션 흐름
1. 사용자가 **업체 불러오기** 클릭 → 내부 엑셀에서 데이터 로드  
2. **협정설정**에서 협정 수·조건 입력 → 빈 행 생성  
3. 업체풀에서 후보를 **드래그하여 행에 배치**  
4. 배치 즉시 계산엔진이 작동 → 총점/적격여부/참여비율 등 자동 갱신  
5. 필요 시 지분율 수동 조정 (자동 보정 옵션)  
6. 제약 위반 시 색상 경고 및 툴팁 표시  
7. 모든 협정 완료 후 **검증** 실행 → 엑셀 대조/위반 0건 확인  
8. **Export**로 제출용 파일 출력

---

## 5. 시각적 요소 규칙
- **색상체계**
  - 적격: 녹색 배지
  - 경계: 노랑 경고
  - 위반: 빨강 배지
- **테이블 강조**
  - 지분 합계 100% 아닐 시 셀 강조
- **실시간 계산**
  - 150ms 내 반영, 드래그 중 프리뷰 표시

---

## 6. 확장 고려사항
- 자동협정 알고리즘(ILP or 휴리스틱)
- 제약조건 프로파일 관리
- 스냅샷 비교 / 변경 로그
- 발주처별 출력 템플릿 지원

---

**작성일:** 2025-10-14  
**작성자:** ChatGPT (기획 초안용)  
**용도:** Codex 개발 전달용 문서
